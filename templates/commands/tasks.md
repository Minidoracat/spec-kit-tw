---
description: 根據可用的設計工件為功能生成可操作的、依賴關係排序的 tasks.md。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 使用者輸入

```text
$ARGUMENTS
```

在繼續之前，你**必須**考慮使用者輸入（如果不為空）。

## 大綱

1. **設定**：從儲存庫根目錄執行 `{SCRIPT}` 並解析 FEATURE_DIR 和 AVAILABLE_DOCS 清單。所有路徑必須是絕對路徑。對於參數中包含單引號的情況（如 "I'm Groot"），請使用轉義語法：例如 'I'\''m Groot'（或者如果可能，使用雙引號："I'm Groot"）。

2. **載入設計文件**：從 FEATURE_DIR 讀取：
   - **必需**：plan.md（技術堆疊、函式庫、結構）、spec.md（具有優先順序的使用者故事）
   - **選填**：data-model.md（實體）、contracts/（API 端點）、research.md（決策）、quickstart.md（測試情境）
   - 注意：並非所有專案都有所有文件。根據可用內容生成任務。

3. **執行任務生成工作流程**（遵循範本結構）：
   - 載入 plan.md 並提取技術堆疊、函式庫、專案結構
   - **載入 spec.md 並提取具有其優先順序（P1、P2、P3 等）的使用者故事**
   - 如果存在 data-model.md：提取實體 → 對應到使用者故事
   - 如果存在 contracts/：每個檔案 → 將端點對應到使用者故事
   - 如果存在 research.md：提取決策 → 生成設定任務
   - **生成按使用者故事組織的任務**：
     - 設定任務（所有故事所需的共享基礎架構）
     - **基礎任務（在任何使用者故事開始之前必須完成的先決條件）**
     - 對於每個使用者故事（按優先順序 P1、P2、P3...）：
       - 將完成該故事所需的所有任務分組
       - 包括該故事特定的模型、服務、端點、UI 元件
       - 標記哪些任務可以 [P] 平行化
       - 如果請求測試：包括該故事特定的測試
     - 完善/整合任務（跨領域關注點）
   - **測試是可選的**：僅在功能規格中明確請求或使用者要求 TDD 方法時生成測試任務
   - 應用任務規則：
     - 不同檔案 = 標記 [P] 以進行平行
     - 相同檔案 = 順序（無 [P]）
     - 如果請求測試：實作之前的測試（TDD 順序）
   - 依序編號任務（T001、T002...）
   - 生成顯示使用者故事完成順序的依賴圖
   - 為每個使用者故事建立平行執行範例
   - 驗證任務完整性（每個使用者故事都有所有需要的任務，可獨立測試）

4. **生成 tasks.md**：使用 `.specify/templates/tasks-template.md` 作為結構，填充：
   - 來自 plan.md 的正確功能名稱
   - 階段 1：設定任務（專案初始化）
   - 階段 2：基礎任務（所有使用者故事的阻塞先決條件）
   - 階段 3+：每個使用者故事一個階段（按 spec.md 的優先順序）
     - 每個階段包括：故事目標、獨立測試標準、測試（如果請求）、實作任務
     - 清晰的 [Story] 標籤（US1、US2、US3...）用於每個任務
     - 每個故事中可平行化任務的 [P] 標記
     - 每個故事階段後的檢查點標記
   - 最終階段：完善和跨領域關注點
   - 按執行順序編號的任務（T001、T002...）
   - 每個任務的清晰檔案路徑
   - 顯示故事完成順序的依賴項段落
   - 每個故事的平行執行範例
   - 實作策略段落（首先是 MVP，增量交付）

5. **報告**：輸出生成的 tasks.md 的路徑和摘要：
   - 總任務計數
   - 每個使用者故事的任務計數
   - 識別的平行機會
   - 每個故事的獨立測試標準
   - 建議的 MVP 範圍（通常僅為使用者故事 1）

用於任務生成的上下文：{ARGS}

tasks.md 應該立即可執行 - 每個任務必須足夠具體，以便 LLM 無需額外上下文即可完成它。

## 任務生成規則

**關鍵**：任務必須按使用者故事組織，以實現獨立的實作和測試。

**測試是可選的**：僅在功能規格中明確請求或使用者要求 TDD 方法時生成測試任務。

### 檢查清單格式（必需）

每個任務都必須嚴格遵循此格式：

```text
- [ ] [TaskID] [P?] [Story?] Description with file path
```

**格式組成**：

1. **核取方塊**：必須以 `- [ ]` 開頭（Markdown 核取方塊）
2. **任務 ID**：依執行順序編號（T001、T002、T003...）
3. **[P] 標記**：僅當任務可平行執行時包含（不同檔案、無依賴於未完成的任務）
4. **[Story] 標籤**：僅用於使用者故事階段任務
   - 格式：[US1]、[US2]、[US3] 等（對應 spec.md 中的使用者故事）
   - Setup 階段：無故事標籤
   - Foundational 階段：無故事標籤
   - User Story 階段：必須有故事標籤
   - Polish 階段：無故事標籤
5. **描述**：清晰的操作說明與確切檔案路徑

**正確範例**：

- ✅ 正確：`- [ ] T001 Create project structure per implementation plan`
- ✅ 正確：`- [ ] T005 [P] Implement authentication middleware in src/middleware/auth.py`
- ✅ 正確：`- [ ] T012 [P] [US1] Create User model in src/models/user.py`
- ✅ 正確：`- [ ] T014 [US1] Implement UserService in src/services/user_service.py`

**錯誤範例**：

- ❌ 錯誤：`- [ ] Create User model`（缺少 ID 和 Story 標籤）
- ❌ 錯誤：`T001 [US1] Create model`（缺少核取方塊）
- ❌ 錯誤：`- [ ] [US1] Create User model`（缺少 Task ID）
- ❌ 錯誤：`- [ ] T001 [US1] Create model`（缺少檔案路徑）

### 任務組織

1. **從使用者故事（spec.md）** - 主要組織：
   - 每個使用者故事（P1、P2、P3...）都有自己的階段
   - 將所有相關元件對應到它們的故事：
     - 該故事所需的模型
     - 該故事所需的服務
     - 該故事所需的端點/UI
     - 如果請求測試：該故事特定的測試
   - 標記故事依賴項（大多數故事應該是獨立的）

2. **從合約**：
   - 將每個合約/端點 → 對應到它服務的使用者故事
   - 如果請求測試：每個合約 → 在該故事階段的實作之前的合約測試任務 [P]

3. **從資料模型**：
   - 將每個實體 → 對應到需要它的使用者故事
   - 如果實體服務多個故事：放在最早的故事或設定階段
   - 關係 → 適當故事階段中的服務層任務

4. **從設定/基礎架構**：
   - 共享基礎架構 → 設定階段（階段 1）
   - 基礎/阻塞任務 → 基礎階段（階段 2）
   - 故事特定的設定 → 在該故事的階段內

### 階段結構

- **階段 1**：Setup（專案初始化）
- **階段 2**：Foundational（阻塞性前置條件 - 必須在使用者故事之前完成）
- **階段 3+**：User Stories（依優先順序：P1、P2、P3...）
  - 每個故事內部：Tests（如果需要）→ Models → Services → Endpoints → Integration
  - 每個階段應該是完整且可獨立測試的增量
- **Final Phase**：Polish & Cross-Cutting Concerns
